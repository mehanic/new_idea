{{define "content"}}
<div class="container">
    <div class="row">
        <!-- Left Column: Map Section -->
        <div class="col-md-6">
            <h3 class="mt-5">Map Integration (OpenStreetMap)</h3>
            <div id="map" style="width: 100%; height: 600px; border: 1px solid black;"></div>
        </div>

        <!-- Right Column: Restaurant List -->
        <div class="col-md-6">
            <h3 class="mt-5">Restaurants List</h3>
            <div id="restaurant-list" class="mt-3">
                <p>Loading restaurants...</p>
            </div>
        </div>
    </div>
</div>

<!-- Include Leaflet.js for OpenStreetMap -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var map = L.map('map').setView([51.0504, 13.7373], 12); // Center on Dresden

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Fetch main location
        fetch('/static/locations.json')
            .then(response => response.json())
            .then(locations => {
                locations.forEach(location => {
                    L.marker([location.lat, location.lng]).addTo(map)
                        .bindPopup(`<b>${location.name}</b>`);
                });
            })
            .catch(error => console.error('Error loading main location:', error));

        // Fetch restaurant locations
        fetch('/static/restaurants.json')
            .then(response => response.json())
            .then(restaurants => {
                let listContainer = document.getElementById("restaurant-list");
                listContainer.innerHTML = ""; // Clear loading text

                restaurants.forEach(restaurant => {
                    // Add restaurant marker
                    L.marker([restaurant.lat, restaurant.lng], {
                        icon: L.icon({
                            iconUrl: 'https://maps.google.com/mapfiles/ms/icons/red-dot.png',
                            iconSize: [32, 32],
                            iconAnchor: [16, 32]
                        })
                    }).addTo(map)
                        .bindPopup(`<b>${restaurant.name}</b><br>${restaurant.address}`);

                    // Add restaurant info to the list
                    let restaurantDiv = document.createElement("div");
                    restaurantDiv.classList.add("mb-3", "p-2", "border", "rounded");
                    restaurantDiv.innerHTML = `
                        <h5>${restaurant.name}</h5>
                        <p>${restaurant.address}</p>
                        <a href="https://www.google.com/maps/search/?api=1&query=${restaurant.lat},${restaurant.lng}" 
                           target="_blank" class="btn btn-sm btn-primary">
                            View on Google Maps
                        </a>
                    `;
                    listContainer.appendChild(restaurantDiv);
                });
            })
            .catch(error => {
                console.error('Error loading restaurant locations:', error);
                document.getElementById("restaurant-list").innerHTML = "<p>Failed to load restaurant data.</p>";
            });
    });
</script>

{{end}}
