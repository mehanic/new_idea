{{define "content"}}
<div class="container">
    <div class="row">
        <!-- Left Column: Map Section -->
        <div class="col-md-6">
            <h3 class="mt-5">Map Integration (MapLibre GL JS - OpenStreetMap)</h3>
            <div id="map" style="width: 100%; height: 600px; border: 1px solid black; border-radius: 10px;"></div>
        </div>

        <!-- Right Column: Restaurant List -->
        <div class="col-md-6">
            <h3 class="mt-5">Restaurants List</h3>
            <div id="restaurant-list" class="mt-3">
                <p>Loading restaurants...</p>
            </div>
        </div>
    </div>
</div>

<!-- Include MapLibre GL JS -->
<link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
<script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>

<script>
    // Initialize MapLibre GL JS with a high-definition style (MapTiler)
    let map = new maplibregl.Map({
        container: 'map',
        style: 'https://api.maptiler.com/maps/streets/style.json?key=sGsPEDsLUVNHhxHb7iej', // MapTiler style URL
        center: [13.7373, 51.0504], // Dresden center
        zoom: 12,
        pixelRatio: 2,  // Increases map rendering quality on higher DPI screens
    });

    // Add zoom and rotation controls
    map.addControl(new maplibregl.NavigationControl());

    // Fetch restaurant locations
    fetch('/static/restaurants.json')
        .then(response => response.json())
        .then(restaurants => {
            let listContainer = document.getElementById("restaurant-list");
            listContainer.innerHTML = ""; // Clear loading text

            restaurants.forEach(restaurant => {
                // Create a MapLibre marker with a smaller size
                let marker = new maplibregl.Marker({
                        color: "red",
                        scale: 0.5  // This scales the marker to half its size
                    })
                    .setLngLat([restaurant.lng, restaurant.lat])
                    .setPopup(new maplibregl.Popup().setHTML(`
                        <div style="text-align: center; font-size: 14px;">
                            <b>${restaurant.name}</b><br>
                            üìç ${restaurant.address}<br>
                            <a href="https://www.openstreetmap.org/?mlat=${restaurant.lat}&mlon=${restaurant.lng}#map=17/${restaurant.lat}/${restaurant.lng}" 
                               target="_blank" class="btn btn-sm btn-primary" style="margin-top: 5px;">
                                View on OpenStreetMap
                            </a>
                        </div>
                    `))
                    .addTo(map);

                // Add restaurant info to the list
                let restaurantDiv = document.createElement("div");
                restaurantDiv.classList.add("mb-3", "p-2", "border", "rounded");
                restaurantDiv.innerHTML = `
                    <h5>${restaurant.name}</h5>
                    <p><b>Address:</b> ${restaurant.address}</p>
                    <p><b>Description:</b> ${restaurant.description || "No description available"}</p>
                    <a href="https://www.openstreetmap.org/?mlat=${restaurant.lat}&mlon=${restaurant.lng}#map=17/${restaurant.lat}/${restaurant.lng}" 
                       target="_blank" class="btn btn-sm btn-primary">
                        View on OpenStreetMap
                    </a>
                `;
                listContainer.appendChild(restaurantDiv);
            });
        })
        .catch(error => {
            console.error('Error loading restaurant locations:', error);
            document.getElementById("restaurant-list").innerHTML = "<p>Failed to load restaurant data.</p>";
        });
</script>

{{end}}
